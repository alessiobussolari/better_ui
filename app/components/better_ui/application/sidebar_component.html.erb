<%# Overlay per chiudere la sidebar su mobile %>
<div data-sidebar-target="overlay" data-action="click->sidebar#close" class="<%= overlay_classes %>"></div>

<%# Container principale della sidebar %>
<div class="<%= container_classes %>" data-sidebar-target="container" <%= @data&.map { |k, v| "data-#{k}=\"#{v}\"" }&.join(' ')&.html_safe %>>
  <%# Header della sidebar con titolo e pulsante di chiusura (opzionale) %>
  <% if @title.present? %>
    <div class="<%= header_classes %>">
      <% if @title.is_a?(String) %>
        <div class="flex items-center p-2">
          <div class="bg-gray-900 rounded-md p-2 mr-2">
            <svg class="w-5 h-5 text-white" aria-hidden="true" fill="currentColor" viewBox="0 0 24 24">
              <path fill-rule="evenodd" d="M4.5 9.75a6 6 0 0111.573-2.226 3.75 3.75 0 014.133 4.303A4.5 4.5 0 0118 20.25H6.75a5.25 5.25 0 01-2.23-10.004 6.072 6.072 0 01-.02-.496z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <div>
            <h2 class="text-base font-semibold text-gray-900"><%= @title %></h2>
            <p class="text-sm text-gray-500">Enterprise</p>
          </div>
        </div>
      <% else %>
        <%= @title.html_safe %>
      <% end %>
      
      <%# Pulsante per chiudere la sidebar su mobile %>
      <% if @variant != :modern %>
        <button 
          type="button" 
          data-action="sidebar#close" 
          class="md:hidden ml-auto rounded-lg p-1.5 focus:outline-none focus:ring-2 focus:ring-gray-200"
          aria-label="Chiudi"
        >
          <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      <% end %>
    </div>
  <% end %>
  
  <%# Menu principale della sidebar %>
  <div class="flex-grow overflow-y-auto py-3">
    <nav>
      <% 
        current_section = nil
        @items.each_with_index do |item, index| 
      %>
        <% if item[:divider] %>
          <hr class="<%= divider_classes %>">
        <% elsif item[:heading] %>
          <% current_section = item[:heading] %>
          <div class="<%= section_heading_classes %> uppercase">
            <%= current_section %>
          </div>
        <% else %>
          <% 
            # Aggiungi automaticamente l'intestazione della sezione se è il primo elemento e non c'è un'intestazione
            if index == 0 && !@items.any? { |i| i[:heading].present? }
              current_section = "PLATFORM"
          %>
            <div class="<%= section_heading_classes %> uppercase">
              <%= current_section %>
            </div>
          <% end %>
          
          <div>
            <% if item[:url].present? && !has_children?(item) %>
              <a 
                href="<%= item[:url] %>" 
                class="<%= menu_item_classes(active_item?(item)) %>"
                <% if item[:target].present? %>target="<%= item[:target] %>"<% end %>
              >
                <% if item[:icon].present? %>
                  <span class="flex-shrink-0 mr-3 text-gray-500 w-5 h-5 flex items-center justify-center">
                    <% if item[:icon] == "table-cells" %>
                      <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3a2 2 0 00-2 2v10a2 2 0 002 2h14a2 2 0 002-2V5a2 2 0 00-2-2H5zm0 2h3v10H5V5zm5 0h10v2H10V5zm0 4h4v6h-4V9zm6 0h4v6h-4V9z" />
                      </svg>
                    <% elsif item[:icon] == "book" %>
                      <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                      </svg>
                    <% elsif item[:icon] == "gear" %>
                      <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                      </svg>
                    <% elsif item[:icon] == "cube" %>
                      <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                      </svg>
                    <% else %>
                      <%= render BetterUi::General::IconComponent.new(name: item[:icon]) %>
                    <% end %>
                  </span>
                <% end %>
                <span class="<%= item_label_classes %>"><%= item[:label] %></span>
                
                <svg class="w-5 h-5 ml-auto text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
              </a>
            <% else %>
              <% dropdown_id = "dropdown-#{SecureRandom.hex(4)}" %>
              <div class="flex flex-col">
                <button 
                  type="button" 
                  class="<%= menu_item_classes(active_item?(item), false, has_children?(item)) %>" 
                  data-action="sidebar#toggleSubmenu"
                  data-sidebar-target="dropdown"
                  aria-expanded="<%= active_item?(item) ? "true" : "false" %>"
                  aria-controls="<%= dropdown_id %>"
                >
                  <% if item[:icon].present? %>
                    <span class="flex-shrink-0 mr-3 text-gray-500 w-5 h-5 flex items-center justify-center">
                      <% if item[:icon] == "table-cells" %>
                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3a2 2 0 00-2 2v10a2 2 0 002 2h14a2 2 0 002-2V5a2 2 0 00-2-2H5zm0 2h3v10H5V5zm5 0h10v2H10V5zm0 4h4v6h-4V9zm6 0h4v6h-4V9z" />
                        </svg>
                      <% elsif item[:icon] == "book" %>
                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                        </svg>
                      <% elsif item[:icon] == "gear" %>
                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                      <% elsif item[:icon] == "cube" %>
                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                        </svg>
                      <% else %>
                        <%= render BetterUi::General::IconComponent.new(name: item[:icon]) %>
                      <% end %>
                    </span>
                  <% end %>
                  
                  <span class="<%= item_label_classes %>"><%= item[:label] %></span>
                  
                  <svg class="w-5 h-5 ml-auto text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-sidebar-target="chevron">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </button>
                
                <% if has_children?(item) %>
                  <div 
                    id="<%= dropdown_id %>" 
                    class="pl-5 <%= active_item?(item) ? "" : "hidden" %>" 
                    data-sidebar-target="submenu"
                  >
                    <% item[:children].each do |child| %>
                      <a 
                        href="<%= child[:url] || '#' %>" 
                        class="block py-2.5 pr-3 text-gray-700 hover:bg-gray-50 hover:text-gray-900"
                        <% if child[:target].present? %>target="<%= child[:target] %>"<% end %>
                      >
                        <%= child[:label] %>
                      </a>
                    <% end %>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>
        <% end %>
      <% end %>
    </nav>
  </div>
  
  <%# Footer della sidebar (opzionale) %>
  <% if @footer.present? %>
    <div class="<%= footer_classes %>">
      <% if @footer.is_a?(String) %>
        <%= @footer.html_safe %>
      <% else %>
        <%= @footer.html_safe %>
      <% end %>
    </div>
  <% end %>
  
  <%# Pulsante per il toggle della sidebar (opzionale) %>
  <% if @collapsible && @variant != :modern %>
    <button 
      type="button" 
      class="<%= toggle_button_classes %>" 
      data-action="sidebar#toggle" 
      data-sidebar-target="toggleButton"
      aria-label="<%= @position == :left ? 'Espandi/Contrai sidebar' : 'Espandi/Contrai sidebar' %>"
    >
      <svg 
        class="w-4 h-4 transition-transform" 
        data-sidebar-target="toggleIcon"
        aria-hidden="true" 
        xmlns="http://www.w3.org/2000/svg" 
        fill="none" 
        viewBox="0 0 24 24"
      >
        <% if @position == :left %>
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 19l-7-7 7-7"/>
        <% else %>
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l7-7-7-7"/>
        <% end %>
      </svg>
    </button>
  <% end %>
</div> 